<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>	
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>	

    </head>
<body><script type="text/javascript">
          var LocalID = $.cookie("LocalID");
          var datagrid2;
          var ad;
          var jsondata2 = { "total": 0, "rows": [] };
          $(function () {
              Ajax(true, global.yd["GetPKPicInfoList"], { LoginID: LocalID }, function (data) {
                  if (!data.Success) {
                      alert(data.Message);
                      return;
                  }
                  $('#sscd').combobox({
                      data: data.Data,
                      valueField: 'pic_id',
                      textField: 'pic_name',
                      onLoadSuccess: function () {
                          var data = $('#sscd').combobox('getData');
                          $("#sscd").combobox('select', data[0].pic_id);
                      }
                  });
              });
              $('#win3').window('close');
              datagrid2 = $("#dg2").datagrid({
                  idField: "led_name",
                  fitColumns: true,
                  striped: true,
                  title: "场地维护",
                  collapsible: true,
                  remotesort: false,
                  rownumbers: true,
                  singleSelect: true,
                  columns: [[{
                      field: 'led_id',
                      title: '编号',
                      width: 80

                  }, {
                      field: 'led_num',
                      title: '第几LED',
                      width: 80

                  }, {
                      field: 'led_name',
                      title: 'LED名',
                      width: 80

                  }, {
                      field: 'range_id',
                      title: '场地编号',
                      width: 80
                  }, {
                      field: 'ip',
                      title: 'IP',
                      width: 80

                  }, {
                      field: 'last_time',
                      title: '最后时间',
                      width: 80
                  }
            ]],
                  toolbar: [{
                      text: "删除", iconCls: "icon-remove", handler: function () {
                          var rowData = datagrid2.datagrid('getSelections');
                          if (rowData == null || rowData.length == 0) {
                              $.messager.alert("提示", "未选择项", "error");
                              return;
                          }
                          var ids;
                          $.messager.confirm("提示", "确定要删除所选项？", function (data) {
                              if (data) {
                                  for (var i = 0; i < rowData.length; i++) {
                                      ids = rowData[i].led_id;
                                      Ajax(true, global.yd["RemovePKLedInfo"], { LoginID: LocalID, led_id: ids }, function (data) {
                                          if (!data.Success) {
                                              alert(data.Message);
                                              return;
                                          }
                                          loaddata2();
                                          $.messager.alert("提示", "删除成功", "info");
                                      });
                                  }
                              }
                          });
                      }
                  }, {
                      text: "修改", iconCls: "icon-edit", handler: function () {
                          var rows = datagrid2.datagrid('getSelected');
                          if (rows == null) {
                              $.messager.alert("提示", "未选择项", "error");
                              return;
                          }
                          $('#win3').window('open');
                          $("#ledname").val(rows.led_name);
                          $("#sscd").combobox("setValue", rows.range_id);
                          $("#ip").val(rows.ip);
                          $("#ledname").select();
                          $("#ledid").val(rows.led_num);
                          ad = 1;
                      }
                  }, {
                      text: "增加", iconCls: "icon-add", handler: function () {
                          $('#win3').window('open');
                          Ajax(true, global.yd["GetPKLedInfoMaxID"], { LoginID: LocalID }, function (data) {
                              if (!data.Success) {
                                  alert(data.Message);
                                  return;
                              }
                              $("#ledid").val(data.Data);
                          });
                          $("#ip").val("127.0.0.1");
                          $("#ledname").val("");
                          $("#ledid").select();
                          ad = 0;
                      }

                  }],
                  onDblClickRow: function (rowIndex, rowData) {
                      var rows = datagrid2.datagrid('getSelected');
                      if (rows == null) {
                          $.messager.alert("提示", "未选择项", "error");
                          return;
                      }
                      $('#win3').window('open');
                      $("#ledname").val(rows.led_name);
                      $("#sscd").combobox("setValue", rows.range_id);
                      $("#ledid").val(rows.led_num);
                      $("#ip").val(rows.ip);
                      $("#cdname").select();
                      ad = 1;
                  }
              });
              loaddata2();
              $("#close2").click(function () {
                  $('#win3').window('close');
              });
              $("#save2").click(function () {
                  var ledname = $("#ledname").val();
                  var ledid = $("#ledid").val();
                  var ip = $("#ip").val();
                  var ss = $("#sscd").combobox("getValue");
                  if (ledname == "") {
                      $.messager.alert("提示", "LED名不能为空！", "error");
                      $("#ledname").select();
                      return;
                  }
                  if (ip == "") {
                      $.messager.alert("提示", "IP不能为空！", "error");
                      $("#ip").select();
                      return;
                  }
                  if (ledid == "") {
                      $.messager.alert("提示", "第几LED不能为空！", "error");
                      $("#ledid").select();
                      return;
                  }
                  if (ledname.length > 10) {
                      $.messager.alert("提示", "LED名长度不能超过10！", "error");
                      $("#ledname").select();
                      return;
                  }
                  if (ad == 0) {
                      Ajax(true, global.yd["NewPKLedInfo"], { LoginID: LocalID, led_num: ledid, led_name: ledname, range_id: ss, ip: ip }, function (data) {
                          if (!data.Success) {
                              alert(data.Message);
                              return;
                          }
                          $.messager.alert("提示", "保存成功", "info");
                          $('#win3').window('close');
                          loaddata2();
                      });
                  }
                  if (ad == 1) {
                      var rowData = datagrid2.datagrid('getSelected');
                      var idd = rowData.led_id;
                      Ajax(true, global.yd["UpdatePKLedInfo"], { LoginID: LocalID, led_id: idd, led_num: ledid, led_name: ledname, range_id: ss, ip: ip }, function (data) {
                          if (!data.Success) {
                              alert(data.Message);
                              return;
                          }
                          $.messager.alert("提示", "保存成功", "info");
                          $('#win3').window('close');
                          loaddata2();
                      });
                  }
              });
          });
          function loaddata2() {
              Ajax(true, global.yd["GetPKLedInfoList"], { LoginID: LocalID }, function (data) {
                  if (!data.Success) {
                      alert(data.Message);
                      return;
                  }
                  jsondata2.total = data.Data.length;
                  jsondata2.rows = data.Data;
                  datagrid2.datagrid('loadData', jsondata2);
              });
          }
          function yanzheng(d) {
              Ajax(true, global.yd["ExistPKLedInfoNum"], { LoginID: LocalID,led_num:d.value }, function (data) {
                  if (!data.Success) {
                      alert(data.Message);
                      $("#ledid").select();
                      return;
                  }
              });
          }
</script>

<div class="easyui-layout" data-options="fit:true">
<div data-options="region:'left',split:true,collapsible:false" style="width:100%;">
<div style="width:100%; height:400px;overflow:auto; ">
		<table id="dg2"style="padding: 5px;"data-options=""> </table>  
        </div>
</div>
</div>
<div id="win3" class="easyui-window" title="LED维护" data-options="iconCls:'icon-save',minimizable:false,maximizable:false" style="width:250px;height:220px;padding:5px;">
	<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'center'" style="padding:5px;">
			  <table cellpadding="5">
			<tr>
				<td>LED号：</td>
				<td><input id="ledid" class="easyui-validatebox textbox" data-options="validType:'length[1,4]'" style="width:120px;height:20px;"maxlength="4" onblur="yanzheng(this);"/></td>
			</tr>
			<tr>
			<td>LED名：</td>
				<td><input id="ledname" name="name" class="easyui-validatebox textbox" data-options="required:true, validType: 'length[1,10]', prompt: '请输入采集器名'" style="width:120px;height:20px"/></td>
            </tr>
			<tr>
				<td>IP:</td>
				<td><input id="ip" class="easyui-validatebox textbox"value="127.0.0.1"  data-options="required:true"style="width:120px;height:20px" /></td>
			</tr>
           <tr>
				<td>所属场地:</td>
				<td><select id="sscd" class="easyui-combobox"  style="width:120px;height:20px"></td>
			</tr>
		</table>
		</div>
		<div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
			
            <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" id="close2" style="width:80px">关闭</a>
			<a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" id="save2" style="width:80px">提交</a>
		</div>
	</div>
</div>
</body>
</html>
