<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>	
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>	

    </head>
<body><script type="text/javascript">
          var LocalID = $.cookie("LocalID");
          var datagrid1;
          var ac;
          var jsondata1 = { "total": 0, "rows": [] };
          $(function () {
              datagrid1 = $("#dg1").datagrid({
                  idField: "region_id",
                  fitColumns: true,
                  striped: true,
                  title: "区域维护",
                  collapsible: true,
                  remotesort: false,
                  rownumbers: true,
                  singleSelect: true,
                  columns: [[{
                      field: 'region_id',
                      title: '区域号',
                      width: 80

                  }, {
                      field: 'region_name',
                      title: '区域名',
                      width: 80

                  }
            ]],
                  toolbar: [{
                      text: "删除", iconCls: "icon-remove", handler: function () {
                          var rowData = datagrid1.datagrid('getSelections');
                          if (rowData == null || rowData.length == 0) {
                              $.messager.alert("提示", "未选择项", "error");
                              return;
                          }
                          var ids;
                          $.messager.confirm("提示", "确定要删除所选项？", function (data) {
                              if (data) {
                                  for (var i = 0; i < rowData.length; i++) {
                                      ids = rowData[i].region_id;
                                      Ajax(true, global.yd["RemovePKRegionInfo"], { LoginID: LocalID, id: ids }, function (data) {
                                          if (!data.Success) {
                                              alert(data.Message);
                                              return;
                                          }
                                          loaddata1();
                                          $.messager.alert("提示", "删除成功", "info");
                                      });
                                  }
                              }
                          });
                      }
                  }, {
                      text: "修改", iconCls: "icon-edit", handler: function () {
                          var rows = datagrid1.datagrid('getSelected');
                          if (rows == null) {
                              $.messager.alert("提示", "未选择项", "error");
                              return;
                          }
                          $('#win2').window('open');
                          $("#qyname").val(rows.region_name);
                          $("#qyname").select();
                          ac = 1;
                      }
                  }, {
                      text: "增加", iconCls: "icon-add", handler: function () {
                          $('#win2').window('open');
                          $("#qyname").val("");
                          $("#qyname").select();
                          ac = 0;
                      }

                  }],
                  onDblClickRow: function (rowIndex, rowData) {
                      var rows = datagrid1.datagrid('getSelected');
                      if (rows == null) {
                          $.messager.alert("提示", "未选择项", "error");
                          return;
                      }
                      $('#win2').window('open');
                      $("#qyname").val(rowData.region_name);
                      $("#qyname").select();
                      ac = 1;
                  }
              });
              loaddata1();
              $("#close1").click(function () {
                  $('#win2').window('close');
              });
              $("#save1").click(function () {
                  var qyname = $("#qyname").val();
                  if (qyname == "") {
                      $.messager.alert("提示", "区域名不能为空！", "error");
                      $("#qyname").select();
                      return;
                  }
                  if (qyname.length > 10) {
                      $.messager.alert("提示", "区域名长度不能超过10！", "error");
                      $("#qyname").select();
                      return;
                  }
                  if (ac == 0) {
                      Ajax(true, global.yd["NewPKRegionInfo"], { LoginID: LocalID, region_name: qyname }, function (data) {
                          if (!data.Success) {
                              alert(data.Message);
                              return;
                          }
                          $.messager.alert("提示", "保存成功", "info");
                          $('#win2').window('close');
                          loaddata1();
                      });
                  }
                  if (ac == 1) {
                      var rowData = datagrid1.datagrid('getSelected');
                      var idd = rowData.region_id;
                      Ajax(true, global.yd["UpdatePKRegionInfo"], { LoginID: LocalID, region_id: idd, region_name: qyname }, function (data) {
                          if (!data.Success) {
                              alert(data.Message);
                              return;
                          }
                          $.messager.alert("提示", "保存成功", "info");
                          $('#win2').window('close');
                          loaddata1();
                      });
                  }
              });
          });
          function loaddata1() {
              Ajax(true, global.yd["GetPKRegionInfoList"], { LoginID: LocalID }, function (data) {
                  if (!data.Success) {
                      alert(data.Message);
                      return;
                  }
                  jsondata1.total = data.Data.length;
                  jsondata1.rows = data.Data;
                  datagrid1.datagrid('loadData', jsondata1);

              });
          }
</script>

<div class="easyui-layout" data-options="fit:true">
<div data-options="region:'left',split:true,collapsible:false" style="width:100%;">
<div style="width:100%; height:400px;overflow:auto; ">
		<table id="dg1"style="padding: 5px;"data-options=""> </table>  
        </div>
</div>
</div>
</body>
</html>
