<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
     <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>	
</head>
<body>
       <style type="text/css" >
body {
font-family: verdana,helvetica,arial,sans-serif,宋体;
font-size: 12px;
margin: 0;
padding: 2px;
}
</style>
<script type="text/javascript">
    var LocalID = $.cookie("LocalID");
    var datagrid1;
    var id = null;
    var jsondata1 = { "total": 0, "rows": [] };
    $(function () {

        var editRow = undefined;
        datagrid1 = $("#dg1").datagrid({
            idField: "id",
            fitColumns: true,
            striped: true,
            title: "",
            collapsible: true,
            remotesort: false,
            rownumbers: true,
            columns: [[{
                field: 'road_name',
                title: '线路名',
                //                sortable: true,
                width: 80,
                editor: { type: 'combobox', options: {
                    required: true,
                    data: jsondata.rows,
                    valueField: "id",
                    textField: "road_name",
                    editable: false
                }
                }
            }, {
//                field: 'mach_id',
//                title: '巡检点号',
//                //                sortable: true,
//                width: 80,

//                editor: { type: 'textbox', options: { editable: false} }
//            }, {
                field: 'window_name',
                title: '巡检点名',
                //                sortable: true,
                width: 80,

                editor: { type: 'combobox', options: {
                    required: true,
                    data: Djsondata.rows,
                    valueField: "window_num",
                    textField: "window_name",
                    editable: false
                }
                }
            }]],
            toolbar: [{
                text: "删除", iconCls: "icon-remove", handler: function () {
                    var rowData = datagrid1.datagrid('getSelections');
                    var group_name = rowData.group_name;
                    var ids;
                    if (rowData == null || rowData.length == 0) {
                        $.messager.alert("提示", "未选择项", "error");
                        return;
                    }
                    $.messager.confirm("提示", "确定要删除所选项？", function (data) {
                        if (data) {
                            for (var i = 0; i < rowData.length; i++) {
                                ids = rowData[i].id;
                                Ajax(true, global.xg["RemoveXGRoadMach"], { LoginID: LocalID, id: ids }, function (data) {
                                    if (!data.Success) {
                                        alert(data.Message);
                                        return;
                                    }

                                    loaddata1();
                                });
                            }
                            $.messager.alert("提示", "删除成功", "info");
                        }
                    });
                }
            }, {
                text: "增加", iconCls: "icon-add", handler: function () {
                    var roww = datagrid.datagrid('getSelected');
                    if (editRow != undefined) {
                        datagrid1.datagrid('endEdit', editRow);
                    }
                    if (editRow == undefined) {
                        datagrid1.datagrid('insertRow', {
                            index: 0,
                            row: {
                                road_name: roww.road_name,
                                mach_name: ''
                            }
                        });
                        datagrid1.datagrid('beginEdit', 0);
                        editRow = 0;
                    }
                        
                }
            }, {
                text: "保存", iconCls: "icon-save", handler: function () {
                    if (editRow == 0) {
                        var hp = $("#dg1").datagrid('getEditor', { index: 0, field: 'road_name' });
                        var hd = $(hp.target).combobox("getValue");
                        var hp1 = $("#dg1").datagrid('getEditor', { index: 0, field: 'window_name' });
                        var hk = $(hp1.target).combobox("getValue");
                        if (hd == "") {
                            $.messager.alert("提示", "巡检线路不能为空", "error");
                            return;
                        }
                        if (hk == "") {
                            $.messager.alert("提示", "巡检点不能为空", "error");
                            return;
                        }
                        Ajax(true, global.xg["NewXGRoadMach"], { LoginID: LocalID, road_id: hd, mach_id: hk }, function (data) {
                            if (!data.Success) {
                                alert(data.Message);
                                return;
                            }
                            $.messager.alert("提示", "保存成功", "info");
                            loaddata1();
                        });
                        editRow = undefined;
                    }
                }
            }, {
                text: "取消", iconCls: "icon-redo", handler: function () {
                    editRow = undefined;
                    datagrid1.datagrid('rejectChanges');
                    datagrid1.datagrid('unselectAll');
                }

            }]
        });
        loaddata1();

    });



    function loaddata1() {
        datagrid1.datagrid('unselectAll');
        var row = datagrid.datagrid('getSelected');
        Ajax(true, global.xg["GetXGRoadMachList"], { LoginID: LocalID }, function (data) {
            if (!data.Success) {
                alert(data.Message);
                return;
            }
            jsondata1.rows = data.Data;
            datagrid1.datagrid('loadData', jsondata1);
        });
    }
    </script>
<div class="easyui-panel" title="" data-options="collapsible:false" style="">
<div data-options="region:'left',split:true,collapsible:false" style="width:98%;padding: 2px;">
       <table id="dg1"></table>
      </div>

	
     </div>
</body>
</html>
