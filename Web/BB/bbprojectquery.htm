<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <link href="../../Scripts/jquery-easyui/themes/IconExtension.css" rel="stylesheet"
        type="text/css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <style type="text/css">
        body
        {
            font-family: verdana,helvetica,arial,sans-serif,宋体;
            font-size: 12px;
            margin: 0;
            padding: 2px;
        }
        h2
        {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 15px;
        }
        .demo-info
        {
            padding: 0 0 12px;
        }
        .demo-tip
        {
            display: none;
        }
        .textbox
        {
            height: 20px;
            margin: 0;
            padding: 0 2px;
            box-sizing: content-box;
        }
        .style1
        {
            width: 960px;
            height: 746px;
        }
        .style3
        {
            height: 54px;
            width: 122px;
            text-align: center;
        }
        .style56
        {
            width: 137px;
            text-align: center;
        }
        .style57
        {
            text-align: center;
        }
        #Text1
        {
            width: 206px;
        }
        .style65
        {
            text-align: center;
            height: 174px;
            width: 122px;
        }
        .style68
        {
            width: 137px;
            text-align: center;
            height: 78px;
        }
        .style69
        {
            text-align: center;
            height: 38px;
        }
        .style70
        {
            text-align: center;
            height: 178px;
            width: 122px;
        }
        .style71
        {
            width: 137px;
            text-align: center;
            height: 82px;
        }
        .style72
        {
            height: 37px;
            text-align: center;
        }
        .style73
        {
            height: 37px;
            width: 137px;
            text-align: center;
        }
        .style74
        {
            text-align: center;
            height: 80px;
            width: 122px;
        }
        .style75
        {
            width: 137px;
            text-align: center;
            height: 38px;
        }
        .style76
        {
            text-align: center;
            height: 30px;
        }
        .style77
        {
            height: 30px;
            width: 137px;
            text-align: center;
        }
        .style78
        {
            text-align: center;
            height: 33px;
        }
        .style79
        {
            height: 33px;
            width: 137px;
            text-align: center;
        }
        .style80
        {
            text-align: center;
            height: 40px;
        }
        .style81
        {
            text-align: center;
            height: 30px;
            width: 122px;
        }
        .style82
        {
            text-align: center;
            height: 33px;
            width: 122px;
        }
        .style83
        {
            text-align: center;
            width: 122px;
        }
        .style84
        {
            height: 33px;
            width: 139px;
            text-align: center;
        }
        .style85
        {
            height: 37px;
            width: 139px;
            text-align: center;
        }
    </style>
    <script type="text/javascript">
        var LocalID = $.cookie("LocalID");
        var datagrid;
        var jsondata = { "total": 0, "rows": [] };
        var sortName = "id";
        var sortOrder = "asc";
        var PageSize = 10;
        var PageNum = 1;
        $(function () {
            $('#com').combobox({
                onChange: function (newValue, oldValue) {
                    if (newValue == "text") {
                        $('#to').show();
                    }
                    else { $('#to').hide(); }
                }
            });
            datagrid = $("#dg").datagrid({
                idField: "id",
                pagination: true, //显示分页  
                pageSize: PageSize, //分页大小  
                pageList: [10, 20, 50, 100, 1000], //每页的个数  
                //fit: true, //自动补全  
                fitColumns: true,
                striped: true,
                iconCls: "icon-search", //图标  
                title: "项目列表",
                collapsible: true,
                remotesort: false,
                singleSelect: true,
                //rownumbers:true,
                sortName: sortName,
                sortOrder: sortOrder,
                columns: [[{
                    field: 'project_no',
                    title: '项目编号',
                    sortable: true,
                    width: 50
                }, {
                    field: 'project_name',
                    title: '项目名称',
                    sortable: true,
                    width: 50
                }, {
                    field: 'project_address',
                    title: '项目所在地',
                    sortable: true,
                    width: 50
                }, {
                    field: 'begin_time',
                    title: '报备时间',
                    sortable: true,
                    width: 80
                }, {
                    field: 'status_flag',
                    title: '流转进度',
                    sortable: true,
                    width: 50,
                    formatter: function (value, row) {
                        if (value == "0") {
                            return '草案';
                        }
                        if (value == "1") {
                            return '审核中';
                        }
                        if (value == "-1") {
                            return '驳回';
                        }
                        if (value == "2") {
                            return '签约中';
                        }
                        if (value == "3") {
                            return '已签约';
                        }
                    }
                }, {
                    field: 'flag',
                    title: '流转状态',
                    sortable: true,
                    width: 50,
                    formatter: function (value, row) {
                        if (value == "0") {
                            return '结束';
                        }
                        if (value == "1") {
                            return '进行中';
                        }
                        if (value == "2") {
                            return '报备撤销';
                        }
                        if (value == "3") {
                            return '审核撤销';
                        }
                    }
                }, {
                    field: 'end_time',
                    title: '结案时间',
                    sortable: true,
                    width: 80
                }]],
                onSortColumn: function (sort, order) {
                    sortName = sort;
                    sortOrder = order;
                    var project_no = $("#project_no").val();
                    var project_name = $("#project_name").val();
                    var project_address = $("#project_address").val();
                    var bb_user_name = $("#bb_user_name").val();
                    var BeginTime = $("#bbkssj").datetimebox("getValue");
                    var EndTime = $("#bbjssj").datetimebox("getValue");
                    var BeginTimes = $("#jakssj").datetimebox("getValue");
                    var EndTimes = $("#jajssj").datetimebox("getValue");
                    var status_flag = "";
                    var flag = "";
                    if ($("#jxz").prop("checked")) {
                        if (flag != "") {
                            flag += "|";
                        } flag += "1";
                    }
                    if ($("#js").prop("checked")) {
                        if (flag != "") {
                            flag += "|";
                        } flag += "0";
                    }
                    if ($("#bbcs").prop("checked")) {
                        if (flag != "") {
                            flag += "|";
                        } flag += "2";
                    }
                    if ($("#shcs").prop("checked")) {
                        if (flag != "") {
                            flag += "|";
                        } flag += "3";
                    }

                    if ($("#ca").prop("checked")) {
                        if (status_flag != "") {
                            status_flag += "|";
                        } status_flag += "0";
                    }
                    if ($("#shz").prop("checked")) {
                        if (status_flag != "") {
                            status_flag += "|";
                        } status_flag += "1";
                    }
                    if ($("#bh").prop("checked")) {
                        if (status_flag != "") {
                            status_flag += "|";
                        } status_flag += "-1";
                    }
                    if ($("#qyz").prop("checked")) {
                        if (status_flag != "") {
                            status_flag += "|";
                        } status_flag += "2";
                    }
                    if ($("#yqy").prop("checked")) {
                        if (status_flag != "") {
                            status_flag += "|";
                        } status_flag += "3";
                    }
                    loaddata(project_no, project_name, project_address, bb_user_name, BeginTime, EndTime, BeginTimes, EndTimes, status_flag, flag);
                },
                onDblClickRow: function (rowIndex, rowData) {
                    var rows = datagrid.datagrid('getSelected');
                    window.open("bbdayin.htm?id=" + rows.id);
                    if (rows == null) {
                        $.messager.alert("提示", "未选择项", "error");
                        return;
                    }
                }
            });
            $("#dayin").click(function () {
                var div = document.getElementById('cc');
                window.print();
                //            var headstr = "<html><head><title></title></head><body>";
                //            var footstr = "</body></html>";
                //            var newstr = document.getElementById("cc").innerHTML;
                //            var oldstr = document.body.innerHTML;
                //            document.body.innerHTML = headstr + newstr + footstr;
                //            window.print();
                //            document.body.innerHTML = oldstr;
            });
            $("#all").change(function () {
                if ($("#all").prop("checked")) {
                    var d = $("#do").find("input:checkbox");
                    d.prop("checked", true);
                }
                else {
                    var d = $("#do").find("input:checkbox");
                    d.prop("checked", false);
                }
            });
            $('#win2').window('close');
            $('#win1').window('close');
            $("#shengcheng").click(function () {
                $('#win1').window('open');
            });
            $("#save").click(function () {
                var you = "";
                if ($("#xmbh").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "project_no";
                }
                if ($("#xmmc").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "project_name";
                }
                if ($("#xmszd").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "project_address";
                }
                if ($("#bbr").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "bb_user_name";
                }
                if ($("#bbsj").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "begin_time";
                }
                if ($("#lxfs").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "bb_tel";
                }
                if ($("#jasj").prop("checked")) {
                    if (you != "") {
                        you += "|";
                    } you += "end_time";
                }
                if (you == "") {
                    alert("未选择目录项！");
                    return;
                }
                var project_no = $("#project_no").val();
                var project_name = $("#project_name").val();
                var project_address = $("#project_address").val();
                var bb_user_name = $("#bb_user_name").val();
                var BeginTime = $("#bbkssj").datetimebox("getValue");
                var EndTime = $("#bbjssj").datetimebox("getValue");

                var fgf = $('#fgf').combobox('getValue');
                var kinds = $('#com').combobox('getValue');
                var yilai = $('#yilai').combobox('getValue');
                var paixu = $('#paixu').combobox('getValue');
                if (kinds == "") {
                    alert("未选择格式！");
                    return;
                }
                if (kinds == "text") {
                    var url = RTURL + global.export["ExportLZProjectPageFile"] + "?LoginID=" + LocalID + "&columname=" + you + "&exporttype=" + kinds + "&di=" + fgf + "&sortName=" + yilai + "&sortOrder=" + (paixu == "asc" ? false : true) + "&pageSize=" + "100000" + "&pageNum=" + "1";
                    window.open(url);
                }
                else {
                    var url = RTURL + global.export["ExportLZProjectPageFile"] + "?LoginID=" + LocalID + "&columname=" + you + "&exporttype=" + kinds + "&sortName=" + yilai + "&sortOrder=" + (paixu == "asc" ? false : true) + "&pageSize=" + "100000" + "&pageNum=" + "1";
                    window.open(url);
                }
            });
            $("#close").click(function () {
                $('#win1').window('close');
            });
            $("#search").click(function () {
                var project_no = $("#project_no").val();
                var project_name = $("#project_name").val();
                var project_address = $("#project_address").val();
                var bb_user_name = $("#bb_user_name").val();
                var BeginTime = $("#bbkssj").datetimebox("getValue");
                var EndTime = $("#bbjssj").datetimebox("getValue");
                var BeginTimes = $("#jakssj").datetimebox("getValue");
                var EndTimes = $("#jajssj").datetimebox("getValue");
                var status_flag = "";
                var flag = "";
                if ($("#jxz").prop("checked")) {
                    if (flag != "") {
                        flag += "|";
                    } flag += "1";
                }
                if ($("#js").prop("checked")) {
                    if (flag != "") {
                        flag += "|";
                    } flag += "0";
                }
                if ($("#bbcs").prop("checked")) {
                    if (flag != "") {
                        flag += "|";
                    } flag += "2";
                }
                if ($("#shcs").prop("checked")) {
                    if (flag != "") {
                        flag += "|";
                    } flag += "3";
                }

                if ($("#ca").prop("checked")) {
                    if (status_flag != "") {
                        status_flag += "|";
                    } status_flag += "0";
                }
                if ($("#shz").prop("checked")) {
                    if (status_flag != "") {
                        status_flag += "|";
                    } status_flag += "1";
                }
                if ($("#bh").prop("checked")) {
                    if (status_flag != "") {
                        status_flag += "|";
                    } status_flag += "-1";
                }
                if ($("#qyz").prop("checked")) {
                    if (status_flag != "") {
                        status_flag += "|";
                    } status_flag += "2";
                }
                if ($("#yqy").prop("checked")) {
                    if (status_flag != "") {
                        status_flag += "|";
                    } status_flag += "3";
                }
                loaddata(project_no, project_name, project_address, bb_user_name, BeginTime, EndTime, BeginTimes, EndTimes, status_flag, flag);
            });
            loaddata();
        });
        function clkdada() {
            var databox = $("#do").find("input:checkbox");
            var j = 0;
            for (var i = 0; i < databox.length; i++) {
                if (databox[i].checked) {
                    j++;
                }
            }
            if (j <= 2) {
                for (var i = 0; i < databox.length; i++) {
                    if (databox[i].checked) {
                        databox[i].disabled = true;
                    }
                }
            }
            else {
                for (var i = 0; i < databox.length; i++) {
                    if (databox[i].disabled) {
                        databox[i].disabled = false;
                    }
                }
            }
        }
        function loaddata(project_no, project_name, project_address, bb_user_name, BeginTime, EndTime, BeginTimes, EndTimes, status_flag, flag) {
            datagrid.datagrid('unselectAll');
            Ajax(true, global.bb["GetBBProjectPageList"], { LoginID: LocalID, project_no: project_no, project_name: project_name, project_address: project_address, bb_user_name: bb_user_name, BeginTime: BeginTime, EndTime: EndTime, BeginTimes: BeginTimes, EndTimes: EndTimes, status_flag: status_flag, flag: flag, sortName: sortName, sortOrder: (sortOrder == "asc" ? false : true), pageSize: PageSize, pageNum: PageNum
            }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    $('#text').select();
                    return;
                }
                jsondata.total = data.Ex;
                jsondata.rows = data.Data;
                datagrid.datagrid('loadData', jsondata);
                if (jsondata.total == 0) {
                    PageNum = 1;
                }
                var p = datagrid.datagrid('getPager');
                $(p).pagination({
                    beforePageText: '第', //页数文本框前显示的汉字 
                    afterPageText: '页    共 ' + Math.ceil(jsondata.total / PageSize) + ' 页',
                    displayMsg: '当前显示 ' + (PageSize * (PageNum - 1) + (jsondata.total == 0 ? 0 : 1)) + ' - ' + (PageSize * (PageNum - 1) + data.Data.length) + ' 条记录   共 ' + jsondata.total + ' 条记录',
                    onSelectPage: function (pageNumber, pageSize) {
                        PageSize = pageSize;
                        PageNum = pageNumber;
                        if (PageNum < 1) {
                            PageNum = 1;
                        }
                        loaddata(project_no, project_name, project_address, bb_user_name, BeginTime, EndTime, BeginTimes, EndTimes, status_flag, flag);
                    }
                });
            });
        }
    </script>
</head>
<body>
    <div class="easyui-panel" title="条件搜索" data-options="iconCls:'icon-search',collapsible:true"
        style="width: 100%; height: 60px; padding: 3px;">
        项目编号：<input id="project_no" class="easyui-validatebox textbox" data-options="prompt:'请输入项目编号'"
            style="width: 80px;" />
        项目名称：<input id="project_name" class="easyui-validatebox textbox" data-options="prompt:'请输入项目名称'"
            style="width: 80px;" />
        项目所在地：<input id="project_address" class="easyui-validatebox textbox" data-options="prompt:'请输入客户名'"
            style="width: 80px;" />
        报备人：<input id="bb_user_name" class="easyui-validatebox textbox" data-options="prompt:'请输入需求者名'"
            style="width: 80px;" />
        <a href="javascript:void(0)" class="easyui-linkbutton" id="search" data-options="iconCls:'icon-search'">
            查询</a> <a class="easyui-linkbutton" data-options="iconCls:'exicon-20130406125519344_easyicon_net_16'"
                href="javascript:void(0)" id="shengcheng">导出</a>
    </div>
    <div class="easyui-panel" title="更多选项" data-options="iconCls:'icon-add',collapsible:true,collapsed:true"
        style="width: 100%; height: 120px; padding: 5px;">
        状态：
        <input type="checkbox" name="week" id="jxz"  />进行中<input type="checkbox"
            name="week" id="js" />结束<input type="checkbox" name="week" id="bbcs" />报备撤销<input type="checkbox"
                name="week" id="shcs" />审核撤销
        <br />
        进度：<input type="checkbox" name="week" id="ca"  />草案<input type="checkbox"
            name="week" id="shz" />审核中<input type="checkbox" name="week" id="bh" />驳回<input
                type="checkbox" name="week" id="qyz" />签约中
        <input type="checkbox" name="week" id="yqy" />已签约
        <br />
        结案时间：开始:<td>
            <input id="jakssj" class="easyui-datetimebox" data-options="" style="width: 80px;
                height: 20px" />
        </td>
        结束:<td>
            <input id="jajssj" class="easyui-datetimebox" data-options="" style="width: 80px;
                height: 20px" />
        </td>
        报备时间：开始:<td>
            <input id="bbkssj" class="easyui-datetimebox" data-options="" style="width: 80px;
                height: 20px" />
        </td>
        结束:<td>
            <input id="bbjssj" class="easyui-datetimebox" data-options="" style="width: 80px;
                height: 20px" />
        </td>
    </div>
    <div class="noprint" style="width: 100%; height: 800px;">
        <table id="dg">
        </table>
    </div>
    <div id="win1" class="easyui-window" title="导出" data-options="iconCls:'icon-save',minimizable:false,maximizable:false"
        style="width: 500px; height: 225px; padding: 5px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center'" style="padding: 5px;">
                <div style="padding: 5px;">
                    排序依赖：<select id="yilai" class="easyui-combobox" style="width: 80px; height: 25px">
                        <option value="project_no">项目编号</option>
                        <option value="project_name">项目名称</option>
                        <option value="project_address">项目所在地</option>
                        <option value="bb_user_name">报备人</option>
                        <option value="begin_time">报备时间</option>
                        <option value="bb_tel">联系方式</option>
                        <option value="end_time">结案时间</option>
                    </select>
                    排序类型：<select id="paixu" class="easyui-combobox" style="width: 80px; height: 25px">
                        <option value="asc">正序</option>
                        <option value="desc">倒序</option>
                    </select>
                    格式：<select id="com" class="easyui-combobox" style="width: 80px; height: 25px">
                        <option value="text">text</option>
                        <option value="word">word</option>
                        <option value="excel">excel</option>
                    </select>
                </div>
                <div id="do" style="padding: 5px;">
                    <div id="to" style="padding: 5px;">
                        分隔符：<select id="fgf" class="easyui-combobox" style="width: 80px; height: 25px">
                            <option value="|">竖杠</option>
                            <option value=" ">空格</option>
                        </select></div>
                    <input type="checkbox" id="all" checked="checked" />全部
                    <input type="checkbox" id="xmbh" checked="checked" name='databox' onclick='clkdada();' />项目编号
                    <input type="checkbox" id="xmmc" checked="checked" name='databox' onclick='clkdada();' />项目名称
                    <input type="checkbox" id="xmszd" checked="checked" name='databox' onclick='clkdada();' />项目所在地
                    <input type="checkbox" id="bbr" checked="checked" name='databox' onclick='clkdada();' />报备人
                    <input type="checkbox" id="bbsj" checked="checked" name='databox' onclick='clkdada();' />报备时间
                    <input type="checkbox" id="lxfs" checked="checked" name='databox' onclick='clkdada();' />联系方式
                    <input type="checkbox" id="jasj" checked="checked" name='databox' onclick='clkdada();' />结案时间
                </div>
            </div>
            <div data-options="region:'south',border:false" style="text-align: right; padding: 5px 0 0;">
                <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)"
                    id="close" style="width: 80px">取消</a> <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'"
                        href="javascript:void(0)" id="save" style="width: 80px">确定</a>
            </div>
        </div>
    </div>
</body>
</html>
