<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <script type="text/javascript">
        var LocalID = $.cookie("LocalID");
        var datagrid;
        var dd;
        var jsondata = { "total": 0, "rows": [] };
        $(function () {
            datagrid = $("#dg").datagrid({
                idField: "id",
                fitColumns: true,
                striped: true,
                title: "商户维护",
                collapsible: true,
                remotesort: false,
                rownumbers: true,
                singleSelect: true,
                columns: [[{
                    field: 'name',
                    title: '姓名',
                    //                sortable: true,
                    width: 80
                }, {
                    field: 'login_id',
                    title: '登录名',
                    //                sortable: true,
                    width: 80
                }]],
                toolbar: [{
                    text: "删除", iconCls: "icon-remove", handler: function () {
                        var rowData = datagrid.datagrid('getSelections');
                        var ids;
                        if (rowData == null || rowData.length == 0) {
                            $.messager.alert("提示", "未选择项", "error");
                            return;
                        }
                        $.messager.confirm("提示", "确定要删除所选项？", function (data) {
                            if (data) {
                                for (var i = 0; i < rowData.length; i++) {
                                    ids = rowData[i].id;
                                    Ajax(true, global.xf["RemoveXFMerchantInfo"], { LoginID: LocalID, id: ids }, function (data) {
                                        if (!data.Success) {
                                            alert(data.Message);
                                            return;
                                        }
                                        loaddata();
                                    });
                                }
                                $.messager.alert("提示", "删除成功", "info");
                            }
                        });
                    }
                }, {
                    text: "修改", iconCls: "icon-edit", handler: function () {
                        var rows = datagrid.datagrid('getSelected');
                        if (rows == null) {
                            $.messager.alert("提示", "未选择项", "error");
                            return;
                        }
                        $('#win').window('open');
                        $('#name').val(rows.name);
                        $('#login_id').val(rows.login_id);
                        $('#psw').val(rows.psw);
                        dd = 1;

                    }
                }, {
                    text: "增加", iconCls: "icon-add", handler: function () {
                        $('#win').window('open');
                        $('#name').val("");
                        $('#login_id').val("");
                        $('#psw').val("");
                        dd = 0;
                    }
                }]
            });
            loaddata();
            $('#win').window('close');
            $("#close").click(function () {
                $('#win').window('close');
            });
            $("#save").click(function () {
                if (dd == 0) {
                    var name = $('#name').val();
                    var login_id = $('#login_id').val();
                    var psw = $('#psw').val();
                    if (name == "") {
                        alert("姓名不能为空");
                        return;
                    }
                    if (login_id == "") {
                        alert("登录名不能为空");
                        return;
                    }
                    if (psw == "") {
                        alert("密码不能为空");
                        return;
                    }
                    Ajax(true, global.xf["NewXFMerchantInfo"], { LoginID: LocalID, name: name, login_id: login_id, psw: psw }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            return;
                        }
                        $.messager.alert("提示", "添加成功", "info");
                        $('#win').window('close');
                        loaddata();
                    });
                }
                if (dd == 1) {
                    var rows = datagrid.datagrid('getSelected');
                    var id = rows.id;
                    var name = $('#name').val(rows.name);
                    var login_id = $('#login_id').val(rows.login_id);
                    var psw = $('#psw').val(rows.psw);
                    if (name == "") {
                        alert("姓名不能为空");
                        return;
                    }
                    if (login_id == "") {
                        alert("登录名不能为空");
                        return;
                    }
                    if (psw == "") {
                        alert("密码不能为空");
                        return;
                    }
                    Ajax(true, global.xf["UpdateXFMerchantInfo"], { LoginID: LocalID, name: name, login_id: login_id, psw: psw, id: id }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            return;
                        }
                        $.messager.alert("提示", "添加成功", "info");
                        $('#win').window('close');
                        loaddata();
                    });
                }
            });
        });
        function loaddata() {
            datagrid.datagrid('unselectAll');
            Ajax(true, global.xf["GetXFMerchantInfoList"], { LoginID: LocalID }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    return;
                }
                jsondata.rows = data.Data;
                datagrid.datagrid('loadData', jsondata);
            });
        }
    </script>
</head>
<body>
    <div class="easyui-layout" title="商户维护" data-options="fit:true">
        <div data-options="region:'center'" style="padding: 2px; width: 250px">
            <table id="dg" style="padding: 5px;" data-options="">
            </table>
        </div>
    </div>
    <div id="win" class="easyui-window" title="商户维护" data-options="iconCls:'icon-save',minimizable:false,maximizable:false"
        style="width: 250px; height: 200px; padding: 5px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'center'" style="padding: 5px;">
                <table cellpadding="5">
                    <tr>
                        <td>
                            姓名：
                        </td>
                        <td align="left">
                            <input id="name" class="easyui-textbox" style="width: 100px"  />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            登录名：
                        </td>
                        <td align="left">
                            <input id="login_id" class="easyui-textbox" style="width: 100px"  />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            密码：
                        </td>
                        <td align="left">
                            <input id="psw" class="easyui-textbox" type="password" style="width: 100px"  />
                        </td>
                    </tr>
                </table>
            </div>
            <div data-options="region:'south',border:false" style="text-align: right; padding: 5px 0 0;">
                <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)"
                    id="close" style="width: 80px">关闭</a> <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'"
                        href="javascript:void(0)" id="save" style="width: 80px">提交</a>
            </div>
        </div>
    </div>
</body>
</html>
