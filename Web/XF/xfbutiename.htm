<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
</head>
<body>
    <script type="text/javascript">
        var LocalID = $.cookie("LocalID");
        var datagrid2;
        var id = null;
        var jsondata2 = { "total": 0, "rows": [] };
        $(function () {
            var editRow = undefined;
            datagrid2 = $("#dg2").datagrid({
                idField: "id",
                fitColumns: true,
                striped: true,
                title: "",
                collapsible: true,
                remotesort: false,
                rownumbers: true,
                columns: [[{
                    field: 'btmonth',
                    title: '补贴日期',
                    width: '45%',
                    editor: { type: 'datebox' }
                }, {
                    field: 'bt_name',
                    title: '补贴名称',
                    width: '45%',
                    editor: { type: 'textbox', options: { required: true, validType: 'length[1,50]', prompt: '长度不能超过50'} }
                }]]
            });
            loaddata2();
            $("#add2").click(function () {
                if (editRow != undefined) {
                    datagrid2.datagrid('endEdit', editRow);
                }
                if (editRow == undefined) {
                    datagrid2.datagrid('insertRow', {
                        index: 0,
                        row: {
                            id: '',
                            bt_name: '',
                            btmonth: ''
                        }
                    });

                    datagrid2.datagrid('beginEdit', 0);
                    editRow = 0;
                }
            });
            $("#update2").click(function () {

                var rows = datagrid2.datagrid('getSelected');
                if (rows == null) {
                    $.messager.alert("提示", "未选择项", "error");
                    return;
                }
                id = rows.id;
                if (editRow != undefined) {
                    datagrid2.datagrid('endEdit', editRow);
                }
                if (editRow == undefined) {
                    datagrid2.datagrid('insertRow', {
                        index: 0,
                        row: {
                            id: id,
                            bt_name: rows.bt_name,
                            btmonth: rows.btmonth
                        }
                    });

                    datagrid2.datagrid('beginEdit', 0);
                    editRow = 1;
                }
            });
            $("#bao2").click(function () {
                if (editRow == 0) {
                    var bt_name = $("#dg2").datagrid('getEditor', { index: 0, field: 'bt_name' });
                    var btmonth = $("#dg2").datagrid('getEditor', { index: 0, field: 'btmonth' });
                    var bn = $(bt_name.target).textbox("getValue");
                    var bm = $(btmonth.target).datebox("getValue");
                    if (bn == "") {
                        alert("补贴名称不能为空！");
                        return;
                    }
                    else if (bn.length > 50) {
                        alert("补贴名称长度不能长于50！");
                        return;
                    }
                    else {
                        Ajax(true, global.xf["NewXFMngBtmonth"], { LoginID: LocalID, bt_name: bn, btmonth: bm, begindate: bm,enddate:bm }, function (data) {
                            if (!data.Success) {
                                alert(data.Message);
                                datagrid2.datagrid('beginEdit', 0);
                                editRow == 0;
                                return;
                            }
                            $.messager.alert("提示", "保存成功", "info");
                            loaddata2();
                        });
                        editRow = undefined;
                    }
                }
                if (editRow == 1) {
                    var rows = datagrid2.datagrid('getSelected');
                    var id = rows.id;
                    var bt_name = $("#dg2").datagrid('getEditor', { index: 0, field: 'bt_name' });
                    var btmonth = $("#dg2").datagrid('getEditor', { index: 0, field: 'btmonth' });
                    var bn = $(bt_name.target).textbox("getValue");
                    var bm = $(btmonth.target).datebox("getValue");
                    var ids = rows.id;
                    if (bn == "") {
                        alert("补贴名称不能为空！");
                        return;
                    }
                    else if (bn.length > 50) {
                        alert("补贴名称长度不能长于50！");
                        return;
                    }
                    Ajax(true, global.xf["UpdateXFMngBtmonth"], { LoginID: LocalID, bt_name: bn, btmonth: bm, id: id, begindate: bm,enddate:bm }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            datagrid2.datagrid('beginEdit', 0);
                            editRow == 1;
                            return;
                        }
                        $.messager.alert("提示", "修改成功", "info");
                        loaddata2();
                        editRow = undefined;
                    });
                }
            });
            $("#remove2").click(function () {
                var rowData = datagrid2.datagrid('getSelections');
                var groupname = rowData.group_name;
                if (rowData == null || rowData.length == 0) {
                    $.messager.alert("提示", "未选择项", "error");
                    return;
                }

                for (var i = 0; i < rowData.length; i++) {
                    var row = rowData[i];
                    var ids = row.id;
                    Ajax(true, global.xf["RemoveXFMngBtmonth"], { LoginID: LocalID, id: ids }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            return;
                        }
                        loaddata2();
                    });

                } $.messager.alert("提示", "删除成功", "info");


            });
            $("#qu2").click(function () {
                editRow = undefined;
                datagrid2.datagrid('rejectChanges');
                datagrid2.datagrid('unselectAll');
            });
        });


        function loaddata2() {
            datagrid2.datagrid('unselectAll');
            Ajax(true, global.xf["GetXFMngBtmonthList"], { LoginID: LocalID }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    return;
                }
                jsondata2.rows = data.Data;
                datagrid2.datagrid('loadData', jsondata2);
            });
        }
    </script>
    <div class="easyui-layout">
        <a class="easyui-linkbutton" data-options="iconCls:'icon-add'" href="javascript:void(0)"
            id="add2" style="width: 80px">添加</a> <a class="easyui-linkbutton" data-options="iconCls:'icon-edit'"
                href="javascript:void(0)" id="update2" style="width: 80px">修改</a> <a class="easyui-linkbutton"
                    data-options="iconCls:'icon-remove'" href="javascript:void(0)" id="remove2" style="width: 80px">
                    删除</a> <a class="easyui-linkbutton" data-options="iconCls: 'icon-save'" href="javascript:void(0)"
                        id="bao2" style="width: 80px">保存</a> <a class="easyui-linkbutton" data-options="iconCls: 'icon-redo'"
                            href="javascript:void(0)" id="qu2" style="width: 80px">取消</a>
        <div data-options="region:'left',split:true,collapsible:false" style="width: 100%;">
            <table id="dg2">
            </table>
        </div>
    </div>
</body>
</html>
