<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
</head>
<body>
    <script type="text/javascript">
        var LocalID = $.cookie("LocalID");
        var datagrid3;
        var cc;
        var id = null;
        var jsondata3 = { "total": 0, "rows": [] };
        $(function () {
            datagrid3 = $("#dg3").datagrid({
                idField: "id",
                fitColumns: true,
                striped: true,
                title: "",
                collapsible: true,
                remotesort: false,
                rownumbers: true,
                columns: [[{
                    field: 'mealname',
                    title: '餐次名',
                    width: '24%'
                }, {
                    field: 'begintime',
                    title: '开始时间',
                    width: '24%'
                }, {
                    field: 'endtime',
                    title: '结束时间',
                    width: '24%'
                }, {
                    field: 'money',
                    title: '金额',
                    width: '24%'
                }]]
            });
            loaddata3();
            $('#win3').window('close');
            $("#close3").click(function () {
                $('#win3').window('close');
            });
            $("#update3").click(function () {
                var rows = datagrid3.datagrid('getSelected');
                if (rows == null) {
                    $.messager.alert("提示", "未选择项", "error");
                    return;
                }
                $('#win3').window('open');
                $("#mealname").val(rows.mealname);
                $("#begintime").datetimebox(rows.begintime);
                $("#endtime").datetimebox(rows.endtime);
                $("#money").val(rows.money);
                cc = 1;
            });
            $("#save3").click(function () {
                if (cc == 1) {
                    var rows = datagrid.datagrid('getSelected');
                    var id = rows.id;
                    var mealname = $("#mealname").val(rows.mealname);
                    var begintime = $("#begintime").datetimebox(rows.begintime);
                    var endtime = $("#endtime").datetimebox(rows.endtime);
                    var money = $("#money").val(rows.money);
                    if (mealname == "") {
                        alert("餐次名不能为空！");
                        return;
                    }
                    Ajax(true, global.xf["UpdateXFMealtime"], { LoginID: LocalID, mealname: mealname, begintime: begintime, endtime: endtime, money: money, id: id }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            return;
                        }
                        $.messager.alert("提示", "修改成功", "info");
                        $('#win3').window('close');
                        loaddata3();
                    });
                }
            });
        });

        function loaddata3() {
            datagrid3.datagrid('unselectAll');
            Ajax(true, global.xf["GetXFMealtimeList"], { LoginID: LocalID }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    return;
                }
                jsondata3.rows = data.Data;
                datagrid3.datagrid('loadData', jsondata3);

            });
        }
    </script>
    <div class="easyui-layout">
        <a class="easyui-linkbutton" data-options="iconCls:'icon-edit'" href="javascript:void(0)"
            id="update3" style="width: 80px">修改</a>
        <div data-options="region:'left',split:true,collapsible:false" style="width: 100%;">
            <table id="dg3">
            </table>
        </div>
    </div>
</body>
</html>
