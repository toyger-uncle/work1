<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
    var LocalID = $.cookie("LocalID");
    var datagrid3;
    var id = null;
    var jsondata3 = { "total": 0, "rows": [] };
    $(function () {
        var editRow = undefined;
        datagrid3 = $("#dg3").datagrid({
            idField: "id",
            fitColumns: true,
            striped: true,
            title: "",
            collapsible: true,
            remotesort: false,
            rownumbers: true,
            columns: [[{
                //                field: 'id',
                //                title: '编号',
                //                //                sortable: true,
                //                width: 80
                //            }, {
                field: 'post_name',
                title: '岗位',
                //                sortable: true,
                width: '65%',
                editor: { type: 'textbox', options: { required: true, validType: 'length[1,10]', prompt: '长度不能超过10'} }
            }]]
        });
        loaddata3();
        $("#add3").click(function () {
            if (editRow != undefined) {
                datagrid3.datagrid('endEdit', editRow);
            }
            if (editRow == undefined) {
                datagrid3.datagrid('insertRow', {
                    index: 0,
                    row: {
                        id: '',
                        post_name: ''
                    }
                });

                datagrid3.datagrid('beginEdit', 0);
                editRow = 0;
            }
        });
        $("#update3").click(function () {

            var rows = datagrid3.datagrid('getSelected');
            if (rows == null) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            id = rows.id;
            if (editRow != undefined) {
                datagrid3.datagrid('endEdit', editRow);
            }
            if (editRow == undefined) {
                datagrid3.datagrid('insertRow', {
                    index: 0,
                    row: {
                        id: id,
                        post_name: rows.post_name
                    }
                });

                datagrid3.datagrid('beginEdit', 0);
                editRow = 1;
            }
        });
        $("#bao3").click(function () {
            if (editRow == 0) {
                var pn = $("#dg3").datagrid('getEditor', { index: 0, field: 'post_name' });
                var pna = $(pn.target).textbox("getValue");
                if (pna == "") {
                    alert("岗位不能为空！");
                    return;
                }
               else if (pna.length>10) {
                    alert("岗位长度不能超过10！");
                    return;
                }
                else {
                    Ajax(true, sys["NewMngPost"], { LoginID: LocalID, post_name: pna }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            datagrid3.datagrid('beginEdit', 0);
                            editRow == 0;
                            return;
                        }
                        $.messager.alert("提示", "保存成功", "info");
                        loaddata3();
                        editRow = undefined;
                    });
                }
            }
            if (editRow == 1) {
                var rows = datagrid3.datagrid('getSelections');
                var pn = $("#dg3").datagrid('getEditor', { index: 0, field: 'post_name' });
                var pna = $(pn.target).textbox("getValue");
                var ids = rows.id;
                if (pna == "") {
                    alert("岗位不能为空");
                    datagrid3.datagrid('beginEdit', 0);
                    return;
                }
                if (pna.length > 10) {
                    alert("长度不能超过10！");
                    datagrid.datagrid('beginEdit', 0);
                    return;
                }
                Ajax(true, sys["UpdateMngPost"], { LoginID: LocalID, id: ids, post_name: pna }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        datagrid3.datagrid('beginEdit', 0);
                        editRow == 1;
                        return;
                    }
                    $.messager.alert("提示", "修改成功", "info");
                    loaddata3();
                    editRow = undefined;
                });
            }
        });
        $("#remove3").click(function () {
            var rowData = datagrid3.datagrid('getSelections');
            var postname = rowData.post_name;
            if (rowData == null || rowData.length == 0) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            for (var i = 0; i < rowData.length; i++) {
                var row = rowData[i];
                var ids = row.id;
                Ajax(true, sys["RemoveMngPost"], { LoginID: LocalID, id: ids }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    loaddata3();
                });
            } $.messager.alert("提示", "删除成功", "info");



        });
        $("#qu3").click(function () {
            editRow = undefined;
            datagrid3.datagrid('rejectChanges');
            datagrid3.datagrid('unselectAll');
        });
    });

    function loaddata3() {
        datagrid3.datagrid('unselectAll');
        Ajax(true, sys["GetMngPostList"], { LoginID: LocalID }, function (data) {
            if (!data.Success) {
                alert(data.Message);
                return;
            }
            jsondata3.rows = data.Data;
            datagrid3.datagrid('loadData', jsondata3);

        });
    }
    </script>
<div class="easyui-layout" data-options="fit:true">
<a class="easyui-linkbutton" data-options="iconCls:'icon-add'" href="javascript:void(0)" id="add3" style="width:80px">添加</a>
			<a class="easyui-linkbutton" data-options="iconCls:'icon-edit'" href="javascript:void(0)" id="update3" style="width:80px">修改</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-remove'" href="javascript:void(0)" id="remove3" style="width:80px">删除</a>
            <a class="easyui-linkbutton" data-options="iconCls: 'icon-save'" href="javascript:void(0)" id="bao3" style="width:80px">保存</a>
      <a class="easyui-linkbutton" data-options="iconCls: 'icon-redo'" href="javascript:void(0)" id="qu3" style="width:80px">取消</a>
       <div data-options="region:'left',split:true,collapsible:false" style="width:100%;">
		<table id="dg3"></table>
	</div>

	
     </div>
</body>
</html>
