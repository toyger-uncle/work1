<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
      
</head>
<body>
    <script type="text/javascript">
                  var LocalID = $.cookie("LocalID");
                  var datagrid;
                  var id = null;
                  var jsondata = { "total": 0, "rows": [] };
                   var products = [
            {productid:'高',name:'高'},
            {productid:'中',name:'中'},
            {productid:'低',name:'低'},
        ];

            $(function () {
                var editRow = undefined;
                datagrid = $("#dg").datagrid({

                    idField: "id",
                    fitColumns: true,
                    striped: true,
                    title: "",
                    collapsible: true,
                    remotesort: false,
                    rownumbers: true,
                    columns: [[{
                        //                              field: 'id',
                        //                              title: '编号',
                        //                              //                sortable: true,
                        //                              width: 80
                        //                          }, {
                        field: 'tech_post',
                        title: '职称',
                        //                sortable: true,
                        width: 80,
                        editor: { type: 'textbox', options: { required: true, validType: 'length[1,10]', prompt: '长度不能超过10'} }

                    }, {
                        field: 'level_kind',
                        title: '职称等级',
                        //                sortable: true,
                        width: 80,
                        editor: { type: 'combobox', options: { valueField: 'productid', textField: 'name', prompt: '未选择', data: products, required: true} }
                    }]]
                });
                loaddata();
                $("#add").click(function () {
                    if (editRow != undefined) {
                        datagrid.datagrid('endEdit', editRow);
                    }
                    if (editRow == undefined) {
                        datagrid.datagrid('insertRow', {
                            index: 0,
                            row: {
                                id: '',
                                tech_post: '',
                                level_kind: ''
                            }
                        });

                        datagrid.datagrid('beginEdit', 0);
                        editRow = 0;
                    }
                });
                $("#update").click(function () {

                    var rows = datagrid.datagrid('getSelected');
                    if (rows == null) {
                        $.messager.alert("提示", "未选择项", "error");
                        return;
                    }
                    id = rows.id;
                    if (editRow != undefined) {
                        datagrid.datagrid('endEdit', editRow);
                    }
                    if (editRow == undefined) {
                        datagrid.datagrid('insertRow', {
                            index: 0,
                            row: {
                                id: id,
                                tech_post: rows.tech_post,
                                level_kind: rows.level_kind
                            }
                        });

                        datagrid.datagrid('beginEdit', 0);
                        editRow = 1;
                    }
                });
                $("#bao").click(function () {
                    if (editRow == 0) {
                        //                        datagrid.datagrid('endEdit', editRow);

                        var tp = $("#dg").datagrid('getEditor', { index: 0, field: 'tech_post' });
                        var lk = $("#dg").datagrid('getEditor', { index: 0, field: 'level_kind' });
                        var tpa = $(tp.target).textbox("getValue");
                        var lka = $(lk.target).combobox("getValue");
                        if (lka == "") {
                            alert("职称等级出错！");
                            return;
                        }
                        if (tpa == "") {
                            alert("职称出错！");
                            return;
                        }
                        if (tpa.length > 10) {
                            alert("职称长度过长！");
                            return;
                        }
                        Ajax(true, sys["NewTechPost"], { LoginID: LocalID, tech_post: tpa, level_kind: lka }, function (data) {
                            if (!data.Success) {
                                alert(data.Message);
                                //                                                        datagrid.datagrid('beginEdit', 0);
                                //                                                        editRow == 0;
                                return;
                            }

                            $.messager.alert("提示", "保存成功", "info");
                            loaddata();
                            editRow = undefined;
                        });

                    }
                    if (editRow == 1) {
                        var rows = datagrid.datagrid('getSelected');
                        var ids = rows.id;
                        var tp = $("#dg").datagrid('getEditor', { index: 0, field: 'tech_post' });
                        var lk = $("#dg").datagrid('getEditor', { index: 0, field: 'level_kind' });
                        var tpa = $(tp.target).textbox("getValue");
                        var lka = $(lk.target).combobox("getValue");
                        if (lka == "") {
                            alert("职称等级不能为空！");
                            return;
                        }
                         if (tpa == "") {
                            alert("职称不能为空！");
                            return;
                        }
                        if (tpa.length > 10) {
                            alert("长度不能超过10！");
                            return;
                        }
                 
                            Ajax(true, sys["UpdateTechPost"], { LoginID: LocalID, id: ids, tech_post: tpa, level_kind: lka }, function (data) {
                                if (!data.Success) {
                                    alert(data.Message);
                                    datagrid.datagrid('beginEdit', 0);
                                    editRow == 1;
                                    return;
                                }
                                $.messager.alert("提示", "修改成功", "info");
                                loaddata();
                                editRow = undefined;
                            });
                        

                    }
                });
                $("#remove").click(function () {

                    var rowData = datagrid.datagrid('getSelections');
                    var techpost = rowData.tech_post;
                    var levelkind = rowData.level_kind;
                    if (rowData == null || rowData.length == 0) {
                        $.messager.alert("提示", "未选择项", "error");
                        return;
                    }

                    for (var i = 0; i < rowData.length; i++) {
                        var row = rowData[i];
                        var ids = row.id;
                        Ajax(true, sys["RemoveTechPost"], { LoginID: LocalID, id: ids }, function (data) {
                            if (!data.Success) {
                                alert(data.Message);
                                return;
                            }
                            loaddata();
                        });
                    } $.messager.alert("提示", "删除成功", "info");



                });
                $("#qu").click(function () {
                    editRow = undefined;
                    datagrid.datagrid('rejectChanges');
                    datagrid.datagrid('unselectAll');
                });

            });

                 
                 
                  function loaddata() {
                      datagrid.datagrid('unselectAll');
                      Ajax(true, sys["GetTechPostList"], { LoginID: LocalID }, function (data) {
                          if (!data.Success) {
                              alert(data.Message);
                              return;
                          }
                          jsondata.rows = data.Data;
                          datagrid.datagrid('loadData', jsondata);
                      });
                  }
    </script>
<div class="easyui-layout"> 
<a class="easyui-linkbutton" data-options="iconCls:'icon-add'" href="javascript:void(0)" id="add" style="width:80px">添加</a>
			<a class="easyui-linkbutton" data-options="iconCls:'icon-edit'" href="javascript:void(0)" id="update" style="width:80px">修改</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-remove'" href="javascript:void(0)" id="remove" style="width:80px">删除</a>
            <a class="easyui-linkbutton" data-options="iconCls: 'icon-save'" href="javascript:void(0)" id="bao" style="width:80px">保存</a>
       <a class="easyui-linkbutton" data-options="iconCls: 'icon-redo'" href="javascript:void(0)" id="qu" style="width:80px">取消</a>
       <div data-options="region:'left',split:true,collapsible:false" style="width:100%;">
		<table id="dg"></table>
	</div>
 <div data-options="region:'right'" style="padding-top:30px; padding-left:12px;">
 
	</div>
	
     </div>
    
<!--<div id="win1" class="easyui-window" title="" data-options="iconCls:'icon-save'" style="width:260px;height:200px;padding:25px;">
	<div class="easyui-layout" data-options="fit:true">
    
        <div data-options="region:'center'" style="padding:20px;">
		<label >职称</label>
		<input id="techpost" class="easyui-validatebox textbox" data-options="prompt:'请输入职称',required:true,validType:'length[1,6]'" />
        <label >职称级别</label>
        <input id="levelkind" class="easyui-validatebox textbox" data-options="prompt:'请输入职称级别',required:true,validType:'length[1,6]'" />
       </div>
		<div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
			<a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" id="close" style="width:80px">关闭</a>
			<a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" id="save" style="width:80px">提交</a>
		</div>
	</div>
</div>-->
</body>
</html>
