<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
    var LocalID = $.cookie("LocalID");
    var datagrid1;
    var id = null;
    var jsondata1 = { "total": 0, "rows": [] };
    $(function () {
        var editRow = undefined;
        datagrid1 = $("#dg1").datagrid({
            idField: "id",
            fitColumns: true,
            striped: true,
            title: "",
            collapsible: true,
            remotesort: false,
            rownumbers: true,
            columns: [[{
                //                field: 'id',
                //                title: '编号',
                //                //                sortable: true,
                //                width: 80
                //            }, {
                field: 'headship',
                title: '职务',
                //                sortable: true,
                width: '65%',
                editor: { type: 'textbox', options: { required: true, validType: 'length[1,10]', prompt: '长度不能超过10'} }
            }]]
        });
        loaddata1();
        $("#add1").click(function () {
            if (editRow != undefined) {
                datagrid1.datagrid('endEdit', editRow);
            }
            if (editRow == undefined) {
                datagrid1.datagrid('insertRow', {
                    index: 0,
                    row: {
                        id: '',
                        headship: ''
                    }
                });

                datagrid1.datagrid('beginEdit', 0);
                editRow = 0;
            }
        });
        $("#update1").click(function () {

            var rows = datagrid1.datagrid('getSelected');
            if (rows == null) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            id = rows.id;
            if (editRow != undefined) {
                datagrid1.datagrid('endEdit', editRow);
            }
            if (editRow == undefined) {
                datagrid1.datagrid('insertRow', {
                    index: 0,
                    row: {
                        id: id,
                        headship: rows.headship
                    }
                });
                datagrid1.datagrid('beginEdit', 0);
                editRow = 1;
            }
        });
        $("#bao1").click(function () {
            if (editRow == 0) {
                var hp = $("#dg1").datagrid('getEditor', { index: 0, field: 'headship' });
                var hpa = $(hp.target).textbox("getValue");
                if (hpa == "") {
                    alert("职务不能为空！");
                    return;

                }
                else if (hpa.length > 10) {
                    alert("职务长度不能超过10！");
                    return;
                }
                else {
                    Ajax(true, sys["NewHeadship"], { LoginID: LocalID, headship: hpa }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            return;
                        }
                        $.messager.alert("提示", "保存成功", "info");
                        loaddata1();
                        editRow = undefined;
                    });
                }
            }
            if (editRow == 1) {
                var rows = datagrid1.datagrid('getSelected');
                var hp = $("#dg1").datagrid('getEditor', { index: 0, field: 'headship' });
                var hpa = $(hp.target).textbox("getValue");
                var ids = rows.id;
                if (hpa == "") {
                    alert("职务内容出错！");
                    return;

                }
                else if (hpa.length > 10) {
                    alert("长度不能超过10！");
                    return;
                }
                else {
                    Ajax(true, sys["UpdateHeadship"], { LoginID: LocalID, id: ids, headship: hpa }, function (data) {
                        if (!data.Success) {
                            alert(data.Message);
                            datagrid1.datagrid('beginEdit', 0);
                            editRow == 1;
                            return;
                        }
                        $.messager.alert("提示", "修改成功", "info");
                        loaddata1();
                        editRow = undefined;
                    });
                }
            }
        });
        $("#remove1").click(function () {
            var rowData = datagrid1.datagrid('getSelections');

            //            for (var i = 0; i < rowData.length; i++) {
            //                if (i != 0) {
            //                    ids += "|";
            //                }
            //                ids += rowData[i].id;
            //            }
            if (rowData == null || rowData.length == 0) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            for (var i = 0; i < rowData.length; i++) {
                var row = rowData[i];
                var headship = row.headship;
                var ids = row.id;
                Ajax(true, sys["RemoveHeadship"], { LoginID: LocalID, id: ids }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    loaddata1();
                });
            } $.messager.alert("提示", "删除成功", "info");

        });
        $("#qu1").click(function () {
            editRow = undefined;
            datagrid1.datagrid('rejectChanges');
            datagrid1.datagrid('unselectAll');
        });

    });



    function loaddata1() {
        datagrid1.datagrid('unselectAll');
        Ajax(true, sys["GetHeadshipList"], { LoginID: LocalID }, function (data) {
            if (!data.Success) {
                alert(data.Message);
                return;
            }
            jsondata1.rows = data.Data;
            datagrid1.datagrid('loadData', jsondata1);

        });
    }
    </script>
<div class="easyui-layout" data-options="fit:true">
<a class="easyui-linkbutton" data-options="iconCls:'icon-add'" href="javascript:void(0)" id="add1" style="width:80px">添加</a>
			<a class="easyui-linkbutton" data-options="iconCls:'icon-edit'" href="javascript:void(0)" id="update1" style="width:80px">修改</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-remove'" href="javascript:void(0)" id="remove1" style="width:80px">删除</a>
            <a class="easyui-linkbutton" data-options="iconCls: 'icon-save'" href="javascript:void(0)" id="bao1" style="width:80px">保存</a>
       <a class="easyui-linkbutton" data-options="iconCls: 'icon-redo'" href="javascript:void(0)" id="qu1" style="width:80px">取消</a>
       <div data-options="region:'left',split:true,collapsible:false" style="width:100%;">
       
		<table id="dg1"></table>
	</div>

	
     </div>
</body>
</html>
