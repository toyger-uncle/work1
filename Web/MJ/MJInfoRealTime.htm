<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/scene_co_ch.js" type="text/javascript"></script>
    <style type="text/css">
        body
        {
            margin: 0px 0px 0px 0px;
            font: 12px simsun;
            text-align: center;
        }
        #contentright
        {
            width: 248px;
            overflow: scroll;
            left: 0px;
            color: #263457;
            scrollbar-face-color: #9EBFE8;
            scrollbar-shadow-color: #FFFFFF;
            scrollbar-highlight-color: #FFFFFF;
            scrollbar-3dlight-color: #9EBFE8;
            scrollbar-darkshadow-color: #9EBFE8;
            scrollbar-track-color: #FFFFFF;
            scrollbar-arrow-color: #FFFFFF;
        }
        .right_bt
        {
            width: 100%;
            height: 20px;
            text-align: center;
            color: #011a77;
            padding-top: 6px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
        }
        .right_bt span
        {
            font-size: 16px;
            font-weight: bold;
            margin-left: 15px;
            cursor: default;
        }
        .th
        {
            border-right: 1px #b4c2cf solid;
            height: 25px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
            cursor: default;
        }
        .thx
        {
            height: 25px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
            cursor: default;
        }
        .td
        {
            border-right: 1px #b4c2cf solid;
            height: 20px;
            cursor: default;
        }
        .tdx
        {
            height: 20px;
            cursor: default;
        }
        .tr
        {
            background-color: #f1f8fe;
        }
        .trp
        {
            background-color: #ffffff;
        }
        .tr:hover
        {
            background-color: #41acf0;
        }
        .trp:hover
        {
            background-color: #41acf0;
        }
    </style>
</head>
<body style="width: 240px">
    <script type="text/javascript">
        var getTimeMJ = function (value, row, index) {
            if (row.event_date != '') {
                return row.event_date.slice(11, 19);
            } else {
                return null;
            }
        };
        var getFlagMJ = function (value, row, index) {
            if (row.event_reason) {
                return eventReasons[row.event_reason];

            } else {
                return null;
            }
        };
    </script>
    <div class="easyui-layout" data-options="fit:true">
        <div data-options="region:'north',border:true,collapsible:true" title='<center>人员信息</center>'
            style="width: 240px; height: 160px;">
            <table border='0' style='border-bottom: 0px #b4c2cf solid;' cellpadding="0px;width: 240px;"
                cellspacing="0px">
                <tr>
                    <td style='width: 20%;' class='tdx'>
                        &nbsp; 门点：
                    </td>
                    <td style='width: 30%;' id="mjDoor" class='tdx'>
                    </td>
                    <td style='width: 50%;' rowspan="20" colspan="20" class='tdx'>
                        <img id="mjPhoto" src="../../Images/pzcard_pzbz.gif" style='height: 129px; width: 120px'
                            alt="个人相片" />
                    </td>
                </tr>
                <tr>
                    <td style='width: 20%;' class='tdx'>
                        &nbsp; 姓名：
                    </td>
                    <td style='width: 30%;' id="mjName" class='tdx'>
                    </td>
                </tr>
                <tr>
                    <td style='width: 20%;' class='tdx'>
                        &nbsp; 部门：
                    </td>
                    <td style='width: 30%;' id="mjDep" class='tdx'>
                    </td>
                </tr>
                <tr>
                    <td style='width: 20%;' class='tdx'>
                        &nbsp; 工号：
                    </td>
                    <td style='width: 30%;' id="mjNum" class='tdx'>
                    </td>
                </tr>
                <tr>
                    <td style='padding-left: 5px; width: 50%;' id="mjTime" colspan="2" class='tdx'>
                        &nbsp;
                    </td>
                </tr>
            </table>
        </div>
        <div data-options="region:'center'" style='width: 240px;'>
            <table id="dgmj" class="easyui-datagrid" data-options="fitColumns:true,singleSelect:true,nowrap:false">
                <thead>
                    <tr>
                        <th style='width: 100px;' data-options="field:'event_reason',sortable:false,align:'center',formatter:getFlagMJ">
                            状态
                        </th>
                        <th style='width: 90px;' data-options="field:'user_name',align:'center',sortable:false">
                            姓名
                        </th>
                        <th style='width: 90px;' data-options="field:'door_name',align:'center',sortable:false">
                            门名
                        </th>
                        <th style='width: 100px;' data-options="field:'event_date',sortable:false,align:'center',formatter:getTimeMJ">
                            时间
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <script type="text/javascript">
        var fmj = {
            rool: undefined,
            sortName: "id",
            sortOrder: "asc",
            PageSize: 10,
            PageNum: 1,
            LocalID: $.cookie("LocalID"),
            datatable: '',
            maxId: -1,
            id: -1,
            //算table最大索引
            index: -1,
            setData: function (rowData) {
                if (rowData.user_file) {
                    Ajax(true, global.sys["GetUserFile"], { LoginID: fmj.LocalID, id: rowData.user_file }, function (data) {
                        if (data.Success) {
                            if (data.Data.photo && data.Data.photo != '') {
                                document.getElementById('mjPhoto').src = "../../Photo/" + data.Data.photo;
                            } else {
                                document.getElementById('mjPhoto').src = "../../Photo/" + data.Data.photo;
                            }
                            document.getElementById('mjNum').innerHTML = data.Data.userid_num;
                            document.getElementById('mjDep').innerHTML = data.Data.department;
                        }
                        else {
                            document.getElementById('mjPhoto').src = "../../Images/pzcard_pzbz.gif";
                            document.getElementById('mjDep').innerHTML = "&nbsp;";
                        }
                    });
                }
                document.getElementById('mjDoor').innerHTML = rowData.door_name;
                document.getElementById('mjName').innerHTML = rowData.user_name;
                document.getElementById('mjTime').innerHTML = rowData.event_date;
            },
            getMaxId: function () {
                Ajax(true, global.mj["GetNowEventRecorderMjMaxID"], { LoginID: fmj.LocalID
                }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    fmj.maxId = data.Data;
                });
            },
            iniGrid: function () {
                fmj.datatable = $("#dgmj").datagrid({
                    fit: true, //自动补全
                    onClickRow: function (rowIndex, rowData) {
                        fmj.setData(rowData);
                    }
                });
            },
            loaddata: function () {
                var inOutNull = undefined;
                if (fmj.maxId < 0) {
                    return;
                }
                Ajax(true, global.mj["GetNowEventRecorderMjPageList"], { LoginID: fmj.LocalID, id: fmj.maxId, event_reason: inOutNull, sortName: 'id', sortOrder: true, pageSize: 20, pageNum: 1
                }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    //将id值赋给最大值
                    if (data.Data.length && data.Data.length != 0) {
                        for (var i = 0; i < data.Data.length; i++) {
                            if (data.Data[i].id > parseInt(fmj.maxId)) {
                                fmj.maxId = data.Data[i].id;
                            }
                            fmj.datatable.datagrid('insertRow', {
                                index: 0,
                                row: data.Data[i]
                            });
                            fmj.index++;
                            //最后一条记录.
                            if (i == data.Data.length - 1) {
                                fmj.setData(data.Data[i]);
                            }
                        }
                    }
                    if (fmj.index > 19) {
                        for (var i = fmj.index; i > 19; i--) {
                            fmj.datatable.datagrid('deleteRow', i);
                            fmj.index--;
                        }
                    }
                });
            }
        };





        $(function () {
            fmj.iniGrid();
            fmj.getMaxId();
            XCommon.intervalOpt.interval(fmj.loaddata, 10000);
        });
       
    </script>
</body>
</html>
