<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/global.js" type="text/javascript"></script>
    <script src="../../Scripts/scene_lang_ch.js" type="text/javascript"></script>
    <style type="text/css">
        body
        {
            margin: 0px 0px 0px 0px;
            font: 12px simsun;
            text-align: center;
        }
        #contentright
        {
            width: 248px;
            overflow: scroll;
            left: 0px;
            color: #263457;
            scrollbar-face-color: #9EBFE8;
            scrollbar-shadow-color: #FFFFFF;
            scrollbar-highlight-color: #FFFFFF;
            scrollbar-3dlight-color: #9EBFE8;
            scrollbar-darkshadow-color: #9EBFE8;
            scrollbar-track-color: #FFFFFF;
            scrollbar-arrow-color: #FFFFFF;
        }
        .right_bt
        {
            width: 100%;
            height: 20px;
            text-align: center;
            color: #011a77;
            padding-top: 6px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
        }
        .right_bt span
        {
            font-size: 16px;
            font-weight: bold;
            margin-left: 15px;
            cursor: default;
        }
        .th
        {
            border-right: 1px #b4c2cf solid;
            height: 25px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
            cursor: default;
        }
        .thx
        {
            height: 25px;
            background-image: url(../../Picture/pzmain_table_bt.gif);
            cursor: default;
        }
        .td
        {
            border-right: 1px #b4c2cf solid;
            height: 20px;
            cursor: default;
        }
        .tdx
        {
            height: 20px;
            cursor: default;
        }
        .tr
        {
            background-color: #f1f8fe;
        }
        .trp
        {
            background-color: #ffffff;
        }
        .tr:hover
        {
            background-color: #41acf0;
        }
        .trp:hover
        {
            background-color: #41acf0;
        }
    </style>
</head>
<body style="width: 240px">
    <script type="text/javascript">
        var getTimetx = function (value, row, index) {
            if (row && row != '') {
                var str = scene.tongxun[row.work_status] || undefined;
                var img = '<img src=';
                if (row.work_status == '1') {
                    img += "../../Scripts/jquery-easyui/themes/icons/ok.png />";
                } else if (row.work_status == 'N') {
                    img += "../../Scripts/jquery-easyui/themes/icons/no.png />";
                } else if (row.work_status == 'D') {
                    img += "../../Scripts/jquery-easyui/themes/icons/reload.png />";
                } else if (row.work_status == 'S') {
                    img += "../../Scripts/jquery-easyui/themes/icons/undo.png />";
                } else {
                    img += "../../Scripts/jquery-easyui/themes/icons/help.png />";
                }
                return img;
            } else {
                return null;
            }
        };
        var getDoWhattx = function (value, row, index) {
            if (row) {
                var whatDo = scene.whatdo[row.what_do] || '未定义';
                var who = row.what_do.slice(0, 1);
                if (who == 'P') {
                    who = '控制器';
                } else if (who == 'T') {
                    who = '电梯';
                } else if (who == 'Z') {
                    who = '指纹机';
                } else {
                    who == '未定义';
                }
                var str = whatDo + "到";
                str += who + row.control_id;
                return str;
            } else {
                return null;
            }
        };

        var getTimetxReal = function (value, row, index) {
            if (row.event_date) {
                return row.event_date.slice(11, 19);
            } else {
                return '';
            }
        };
    </script>
    <div id="cc" class="easyui-layout" data-options="fit:true">
        <div data-options="region:'center'" style='width: 240px;'>
            <table id="dgtx" class="easyui-datagrid" data-options="fitColumns:true,singleSelect:true,showHeader:false,showFooter:false,nowrap:false">
                <thead>
                    <tr>
                        <th style='width: 10%;' data-options="field:'work_status',align:'center',sortable:false,formatter:getTimetx">
                        </th>
                        <th style='width: 30%;' data-options="field:'event_date',align:'center',sortable:false,formatter:getTimetxReal">
                        </th>
                        <th style='width: 60%;' data-options="field:'what_do',align:'center',sortable:false,formatter:getDoWhattx">
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <script type="text/javascript">
        var ftx = {
            sortName: 'id',
            rool: '',
            sortName: "id",
            sortOrder: "asc",
            PageSize: 10,
            PageNum: 1,
            LocalID: $.cookie("LocalID"),
            datatable: '',
            maxId: -1,
            id: -1,
            //计算table最大索引
            index: -1,
            getMaxId: function () {
                Ajax(true, global.mj["GetNowMjDownInfoMaxID"], { LoginID: ftx.LocalID
                }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    ftx.maxId = data.Data;
                });
            },
            //初始化表格
            iniGrid: function () {
                ftx.datatable = $("#dgtx").datagrid({
                    fit: true //自动补全
                });
            },

            //加载数据
            loaddata: function () {
                var inOutNull = undefined;
                if (ftx.maxId < 0) {
                    return;
                }
                Ajax(true, global.mj["GetNowMjDownInfoPageList"], { LoginID: ftx.LocalID, id: ftx.maxId, sortName: 'id', sortOrder: true, pageSize: 20, pageNum: 1
                }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    //                index++;
                    //                datatable.datagrid('insertRow', {
                    //                    index: 0,
                    //                    row: {
                    //                        work_status: id,
                    //                        what_do: 'T3',
                    //                        event_date: '2015-01-12 15:34:45'
                    //                    }
                    //                });
                    //                id++;

                    if (data.Data.length == 0) {
                        return;
                    }
                    //将id值赋给最大值
                    if (data.Data.length && data.Data.length != 0) {
                        for (var i = 0; i < data.Data.length; i++) {
                            if (data.Data[i].id > parseInt(ftx.maxId)) {
                                ftx.maxId = data.Data[i].id;
                            }
                            ftx.datatable.datagrid('insertRow', {
                                index: 0,
                                row: data.Data[i]
                            });
                            ftx.index = ftx.index + 1;
                        }
                    }
                    if (ftx.index > 19) {
                        for (var i = ftx.index; i > 19; i--) {
                            ftx.datatable.datagrid('deleteRow', i);
                            ftx.index = ftx.index - 1;
                        }
                    }
                });
            }
        };




        $(function () {
            ftx.iniGrid();
            ftx.getMaxId();
            XCommon.intervalOpt.interval(ftx.loaddata, 10000);
        });
     
    </script>
</body>
</html>
