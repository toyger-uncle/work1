<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
     <link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/default/easyui.css"/>
	<link rel="stylesheet" type="text/css" href="../../Scripts/jquery-easyui/themes/icon.css" />
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../Scripts/jquery-easyui/jquery.easyui.min.js"></script>
    <script src="../../Scripts/jquery-easyui/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../Scripts/constant.js" type="text/javascript"></script>
    <script src="../../Scripts/common.js" type="text/javascript"></script>	
</head>
<body>
<script type="text/javascript">
    var LocalID = $.cookie("LocalID");
    var Ldatagrid;
    var Rdatagrid;
    var Ljsondata = { "total": 0, "rows": [] };
    var Rjsondata = { "total": 0, "rows": [] };
    var zt;
    $(function () {
        Ldatagrid = $("#dg").datagrid({
            idField: "id",
            fitColumns: true,
            striped: true,
            title: "",
            collapsible: true,
            remotesort: false,
            rownumbers: true,
            singleSelect: true,
            columns: [[{
                field: 'group_name',
                title: '紧急群组名',
                width: 80
            }]],
            onSelect: function (rowIndex, rowData) {
                loadright();
            }
        });
        loaddata();
        Rdatagrid = $("#dg1").datagrid({
            idField: "id",
            fitColumns: true,
            striped: true,
            title: "",
            collapsible: true,
            remotesort: false,
            rownumbers: true,
            columns: [[{
                field: 'door_name',
                title: '门名',
                width: 80
            }]]
        });
        $("#kai").click(function () {
            var rows = Ldatagrid.datagrid('getSelected');
            if (rows == null) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            var id = rows.id;
            zt = 1;
            Ajax(true, mj["UrgentDoor"], { LoginID: LocalID, urgent_id: id, openOrClose: zt }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    return;
                }
                if (data.Data == true) {
                    $.messager.alert("提示", "发送成功", "info");
                }
                else { $.messager.alert("提示", "发送失败", "error"); }
            });
        });
        $("#guan").click(function () {
            var rows = Ldatagrid.datagrid('getSelected');
            if (rows == null) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            var id = rows.id;
            zt = 0;
            Ajax(true, mj["UrgentDoor"], { LoginID: LocalID, urgent_id: id, openOrClose: zt }, function (data) {
                if (!data.Success) {
                    alert(data.Message);
                    return;
                }
                if (data.Data == true) {
                    $.messager.alert("提示", "发送成功", "info");
                }
                else { $.messager.alert("提示", "发送失败", "error"); }
            });
        });
        $("#jie").click(function () {
            var Player = window.parent.frames["rightfra"].document.getElementById("Player");
            Player.controls.stop();
        });
        $("#hui").click(function () {
            var rows = Ldatagrid.datagrid('getSelected');
            if (rows == null) {
                $.messager.alert("提示", "未选择项", "error");
                return;
            }
            var id = rows.id;
                Ajax(true, mj["UrgentReset"], { LoginID: LocalID, urgent_id: id }, function (data) {
                    if (!data.Success) {
                        alert(data.Message);
                        return;
                    }
                    if (data.Data == true) {
                        $.messager.alert("提示", "发送成功", "info");
                    }
                    else { $.messager.alert("提示", "发送失败", "error"); }
                });
        });
    });

    function loaddata() {
        Ldatagrid.datagrid('unselectAll');
        Ajax(true, mj["GetMjUrgentGroupList"], { LoginID: LocalID }, function (data) {
            if (!data.Success) {
                alert(data.Message);
                return;
            }
            Ljsondata.rows = data.Data;
            Ldatagrid.datagrid('loadData', Ljsondata);
        });
    }
    function loadright() {
        var datarow = Ldatagrid.datagrid('getSelected');
        Rdatagrid.datagrid('unselectAll');
        Ajax(true, mj["GetMjUrgentDoorList"], { LoginID: LocalID, group_id: datarow.id }, function (data) {
            if (!data.Success) {
                alert(data.Message);
                return;
            }
            Rjsondata.total = data.Data.length;
            Rjsondata.rows = data.Data;
            Rdatagrid.datagrid('loadData', Rjsondata);
        });
    }
    </script>
<div class="easyui-panel" title="紧急群组" data-options="collapsible:true,maximized:true" style="width:100%;height:500px; padding:2px;">
	<div class="easyui-layout" data-options="fit:true">
		<div data-options="region:'north',collapsible:false" style="width:100%;height:35px;">
  	        <a class="easyui-linkbutton" data-options="" href="javascript:void(0)" id="kai" style="width:80px">紧急开门</a>
            <a class="easyui-linkbutton" data-options="" href="javascript:void(0)" id="guan" style="width:80px">紧急关门</a>
            <a class="easyui-linkbutton" data-options="" href="javascript:void(0)" id="jie" style="width:80px">解除警报</a>
            <a class="easyui-linkbutton" data-options="" href="javascript:void(0)" id="hui" style="width:80px">恢复自控</a>
  </div>
		<div data-options="region:'west',collapsible:false"  style="width:50%; ">
		 <table id="dg"></table>
		</div>
		<div data-options="region:'center'"  style="text-align:right;padding:2px 0 0; width:50%;">
        <table id="dg1"></table>
		</div>
       
	</div>
 </div>
</body>
</html>
